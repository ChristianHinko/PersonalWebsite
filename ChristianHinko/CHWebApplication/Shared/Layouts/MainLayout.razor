@inherits LayoutComponentBase
@using Services
@using Models
@inject CHLayoutService LayoutService;
@implements IDisposable

<MudRTLProvider RightToLeft="@LayoutService.RightToLeft"> <!-- hook up our LayoutService layout to the MudRTLProvider -->
    <MudThemeProvider @ref="@ThemeProvider" Theme="@LayoutService.Theme" DefaultScrollbar="@LayoutService.DefaultScrollbar" IsDarkMode="@LayoutService.IsDarkMode" IsDarkModeChanged="@LayoutService.SetIsDarkMode" /> <!-- hook up our LayoutService's theming to the MudThemeProvider -->
    <MudDialogProvider />
    <MudSnackbarProvider />
    @Body
</MudRTLProvider>

@code
{
    private MudThemeProvider ThemeProvider { get; set; }

    protected override void OnInitialized()
    {
        // Initialize our layout with the defaults
        LayoutService.SetTheme(CHLayoutDefinition.Theme);
        LayoutService.SetDefaultScrollbar(CHLayoutDefinition.DefaultScrollbar);
        LayoutService.SetIsDarkMode(CHLayoutDefinition.IsDarkMode);
        LayoutService.SetRightToLeft(CHLayoutDefinition.RightToLeft);

        // Listen for layout changes
        LayoutService.LayoutChanged += OnLayoutChanged;
        base.OnInitialized();
    }

    private void OnLayoutChanged(object? sender, EventArgs e) => StateHasChanged(); // re-render from layout change

    public void Dispose()
    {
        // Unbind from layout changes
        LayoutService.LayoutChanged -= OnLayoutChanged;
    }
}
